# Trading Configuration
# Centralized configuration for V6 trading system

# IB Gateway Connection Settings
ib_connection:
  host: "127.0.0.1"
  port: 4002              # Paper trading port (7497 for live)
  client_id: 1
  readonly_port: 7497
  connect_timeout: 10
  max_retries: 3
  retry_delay: 2.0

# Refresh Intervals (seconds)
refresh_intervals:
  position_sync: 300       # Position synchronization (5 min)
  option_chain: 300        # Option chain refresh (5 min)
  portfolio_delta: 60      # Portfolio delta calculation (1 min)
  market_data: 60          # Market data refresh (1 min)
  futures_data: 300        # Futures data collection (5 min)

# Trading Limits
trading_limits:
  max_portfolio_delta: 0.30    # Maximum net portfolio delta
  max_positions_per_symbol: 5  # Max positions per underlying
  max_single_position_pct: 0.20  # Max concentration in single position
  max_correlated_pct: 0.40     # Max correlated exposure

# Note: Profit targets configured in profit_targets section
# (managed by 9-01 Dynamic Profit Targets plan)

# Dynamic Profit Targets by Market Regime
profit_targets:
  # Regime-based take profit thresholds (percentage of max profit)
  # Lower = more defensive (lock profits earlier)
  crash: 0.40              # Very defensive - lock profits at 40%
  high_volatility: 0.50    # Defensive - lock profits at 50%
  normal: 0.80             # Default - let profits run to 80%
  low_volatility: 0.90     # Aggressive - let profits run to 90%
  trending: 0.85           # Trend following - allow more upside
  range_bound: 0.80        # Neutral - standard target

  # Partial profit taking
  partial_tp_enabled: true
  partial_tp_threshold: 0.50   # Take 50% of position at this threshold
  partial_tp_ratio: 0.50       # Close 50% of position

  # Override settings (optional)
  use_regime_tp: true      # Enable regime-based TP (false = use fixed 80%)

# Variance Analysis Configuration
# Manages prediction vs actual tracking for strategy weight tuning
variance_analysis:
  enabled: true
  lookback_days: 30              # Days of predictions to analyze
  min_predictions: 10            # Minimum predictions required for analysis
  weight_adjustment_factor: 0.5  # Max weight reduction for high error (0-1)

  # Strategy-specific base weights
  strategy_weights:
    iron_condor: 1.0             # Base weight for Iron Condor
    bull_put_spread: 1.0         # Base weight for Bull Put Spread
    bear_call_spread: 1.0        # Base weight for Bear Call Spread
    iron_butterfly: 1.0          # Base weight for Iron Butterfly
    vertical_spread: 1.0         # Base weight for Vertical Spread

  # Regime-specific adjustments
  # Multipliers applied to base weights during specific market regimes
  regime_adjustments:
    normal: 1.0                  # No adjustment in normal markets
    high_volatility: 0.8         # Reduce weights in high vol
    crash: 0.5                   # Reduce weights significantly in crash
    trending: 1.0                # No adjustment in trending
    range_bound: 1.0             # No adjustment in range-bound

  # Prediction error thresholds
  # If MAE exceeds these thresholds, weights are reduced
  error_thresholds:
    warning: 0.20                # 20% error triggers warning
    critical: 0.40               # 40% error triggers max weight reduction
